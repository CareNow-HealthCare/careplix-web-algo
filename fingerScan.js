var A=(()=>{let u=1e4,w=6e4,l=!0,f=!1,m=0,F=0,g=0,y,o,p,d,E=[],b=[],I=({timeElapsed:t=0,type:e="",percentage:n=0,isFingerInView:r=!1})=>{},B=({raw_intensity:t=[],ppg_time:e=[],average_fps:n=0})=>{},v=(t=new Error("Fingerscan Error."))=>{},M=()=>new Promise(async(t,e)=>{var n,r,i;try{let a=await navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"environment",aspectRatio:1.7777777777777777}});(i=(r=(n=a.getVideoTracks())==null?void 0:n[0])==null?void 0:r.applyConstraints)==null||i.call(r,{advanced:[{torch:!0}]}).catch(c=>console.error(new Error("Flash could not be acquired.",{cause:c}))),o.srcObject=a,o.onloadedmetadata=()=>{t()}}catch(a){e(new Error("We are not able to access the Camera. Please try again.",{cause:a}))}}),h=(t=!1)=>{var e,n,r,i;cancelAnimationFrame(m),(i=(r=(n=(e=o==null?void 0:o.srcObject)==null?void 0:e.getTracks)==null?void 0:n.call(e))==null?void 0:r.forEach)==null||i.call(r,a=>{var c;(c=a==null?void 0:a.stop)==null||c.call(a)}),f=!1,window.onblur=void 0,y==null||y.release().then(()=>console.log("WakeLock Released.")).catch(a=>{console.log("WakeLock Error."),console.error(a)}),t||B({raw_intensity:E,ppg_time:b,average_fps:Math.round(E.length*1e3/w)})},W=(t={r:0,g:0,b:0})=>{let e;if(t.r<(l?25:5))e=0;else{let n=t.g+t.b,r=l?35:60,i=l?125:150;n<=r?e=1:n>=i?e=0:e=(i-n)/r}return e},R=t=>{let e=0,n={r:0,g:0,b:0};for(let r=0;r<t.data.length;r+=4)t.data[r+3]>0&&(e++,n.r+=t.data[r],n.g+=t.data[r+1],n.b+=t.data[r+2]);return{r:n.r/e,g:n.g/e,b:n.b/e}},q=()=>{let t=o.videoWidth,e=o.videoHeight;d.save(),d.clearRect(0,0,t,e),d.drawImage(o,0,0,t,e);let n=R(d.getImageData(t/5,e/5,t*.6,e*.6));return d.restore(),n},C=async t=>{let e=t-F;try{if(e<=u){let n=q(),r=W(n);I({timeElapsed:e,type:"calibration",percentage:Math.round(e/u*100),isFingerInView:r>.6}),m=requestAnimationFrame(C)}else if(e<=u+w){let n=q(),r=W(n);if(r>.6?g=0:l?g=101:g++,g>100)throw new Error("Please place your Finger correctly on the Back Camera.");E.push(n),b.push(performance.now()-F),I({timeElapsed:e,type:"scan",percentage:Math.round((e-u)/w*100),isFingerInView:r>.6}),m=requestAnimationFrame(C)}else h()}catch(n){h(!0),v(n!=null?n:new Error("Fingerscan Error."))}};return{startScan:async({calibrationTime_inSec:t=10,scanTime_inSec:e=60,strict_mode:n=!0,videoElement:r,canvasElement:i})=>{var a,c;E=[],b=[],f=!1,g=0;try{if(typeof t!="number"||t<3||t>20)throw new Error("Calibration duration can be between 3-20 seconds.");if(typeof e!="number"||e<10||e>120||e%5!==0)throw new Error("Scan duration can be between 10-120 seconds (multiple of 5).");if(t>e)throw new Error("Scan duration cannot be smaller than Calibration duration.");if(u=t*1e3,w=e*1e3,typeof n!="boolean"?(console.error("Provided Strict Mode value is Invalid!\nSwitching to default..."),l=!0):l=n,(a=navigator.wakeLock)==null||a.request("screen").then(s=>{y=s,console.log("WakeLock Active.")}).catch(s=>{console.log("WakeLock Error."),console.error(s)}),o=typeof r>"u"?document.getElementById("videoInput"):r,o)await M(),(c=o.play)==null||c.call(o);else throw new Error("Cannot get the video element.");if(p=typeof i>"u"?document.getElementById("canvasOutput"):i,p)p.width=o.videoWidth,p.height=o.videoHeight,d=p.getContext("2d");else throw new Error("Cannot get the canvas element.");F=performance.now(),m=requestAnimationFrame(C),f=!0,window.onblur=()=>{h(!0),v(new Error("The application was moved to the Background."))}}catch(s){throw h(!0),v(s!=null?s:new Error("Facescan Initialization Error.")),new Error("Facescan Initialization Error.",{cause:s})}},stopScan:h,onFrame:(t=({timeElapsed:e=0,type:n="",percentage:r=0,isFingerInView:i=!1})=>{})=>{typeof t=="function"&&(I=t)},onScanFinish:(t=({raw_intensity:e=[],ppg_time:n=[],average_fps:r=0})=>{})=>{typeof t=="function"&&(B=t)},onError:(t=(e=new Error("Fingerscan Error."))=>{})=>{typeof t=="function"&&(v=t)},get isInitializing(){return()=>!f},get isScanning(){return()=>!!f}}})(),k=A;export{k as default};
