var A=(()=>{let f=1e4,y=6e4,l=!1,g=!1,m=0,b=0,h=0,E,o,p,d,v=[],F=[],I=({timeElapsed:t=0,type:e="",percentage:n=0,isFingerInView:r=!1})=>{},M=({raw_intensity:t=[],ppg_time:e=[],average_fps:n=0})=>{},w=(t=new Error("Fingerscan Error."))=>{},W=()=>new Promise(async(t,e)=>{var n,r,i;try{let a=/iPhone|iPad|iPod|Macintosh|Mac/i.test(navigator.userAgent),s=await navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"environment",aspectRatio:16/9,frameRate:{ideal:60},height:a?{exact:720}:void 0}});(i=(r=(n=s.getVideoTracks())==null?void 0:n[0])==null?void 0:r.applyConstraints)==null||i.call(r,{advanced:[{torch:!0}]}).catch(c=>console.error(new Error("Flash could not be acquired.",{cause:c}))),o.srcObject=s,o.onloadedmetadata=()=>{t()}}catch(a){e(new Error("We are not able to access the Camera. Please try again.",{cause:a}))}}),u=(t=!1)=>{var e,n,r,i;cancelAnimationFrame(m),(i=(r=(n=(e=o==null?void 0:o.srcObject)==null?void 0:e.getTracks)==null?void 0:n.call(e))==null?void 0:r.forEach)==null||i.call(r,a=>{var s;(s=a==null?void 0:a.stop)==null||s.call(a)}),g=!1,window.onblur=void 0,E==null||E.release().then(()=>console.log("WakeLock Released.")).catch(a=>{console.log("WakeLock Error."),console.error(a)}),t||M({raw_intensity:v,ppg_time:F,average_fps:Math.round(v.length*1e3/y)})},B=(t={r:0,g:0,b:0})=>{let e;if(t.r<(l?25:5))e=0;else{let n=t.g+t.b,r=l?35:60,i=l?125:150;n<=r?e=1:n>=i?e=0:e=(i-n)/r}return e},q=t=>{let e=0,n={r:0,g:0,b:0};for(let r=0;r<t.data.length;r+=4)t.data[r+3]>0&&(e++,n.r+=t.data[r],n.g+=t.data[r+1],n.b+=t.data[r+2]);return{r:n.r/e,g:n.g/e,b:n.b/e}},R=()=>{let t=o.videoWidth,e=o.videoHeight;d.save(),d.clearRect(0,0,t,e),d.drawImage(o,0,0,t,e);let n=q(d.getImageData(t/5,e/5,t*.6,e*.6));return d.restore(),n},C=async t=>{let e=t-b;try{if(e<=f){let n=R(),r=B(n);I({timeElapsed:e,type:"calibration",percentage:Math.round(e/f*100),isFingerInView:r>.6}),m=requestAnimationFrame(C)}else if(e<=f+y){let n=R(),r=B(n);if(r>.6?h=0:l?h=101:h++,h>100){u(!0),w(new Error("Ensure your finger is correctly positioned on the camera and there is enough light if the flashlight isn't on."));return}v.push(n),F.push(performance.now()-b),I({timeElapsed:e,type:"scan",percentage:Math.round((e-f)/y*100),isFingerInView:r>.6}),m=requestAnimationFrame(C)}else u()}catch(n){u(!0),w(new Error("Sorry we're unable to compute the signal. Please try again.",{cause:n}))}};return{startScan:async({calibrationTime_inSec:t=10,scanTime_inSec:e=60,strict_mode:n=!1,videoElement:r,canvasElement:i})=>{var a,s;v=[],F=[],g=!1,h=0;try{if(typeof t!="number"||t<3||t>20)throw new Error("Calibration duration can be between 3-20 seconds.");if(typeof e!="number"||e<10||e>120||e%5!==0)throw new Error("Scan duration can be between 10-120 seconds (multiple of 5).");if(t>e)throw new Error("Scan duration cannot be smaller than Calibration duration.");if(f=t*1e3,y=e*1e3,typeof n!="boolean"?(console.error("Provided Strict Mode value is Invalid!\nSwitching to default..."),l=!1):l=n,(a=navigator.wakeLock)==null||a.request("screen").then(c=>{E=c,console.log("WakeLock Active.")}).catch(c=>{console.log("WakeLock Error."),console.error(c)}),o=typeof r>"u"?document.getElementById("videoInput"):r,o)await W(),await((s=o.play)==null?void 0:s.call(o));else throw new Error("Cannot get the video element.");if(p=typeof i>"u"?document.getElementById("canvasOutput"):i,p)p.width=o.videoWidth,p.height=o.videoHeight,d=p.getContext("2d");else throw new Error("Cannot get the canvas element.");b=performance.now(),m=requestAnimationFrame(C),g=!0,window.onblur=()=>{u(!0),w(new Error("App functionality disabled in the Background. Keep it in the Foreground for proper operation."))}}catch(c){throw u(!0),w(c),new Error("Fingerscan Initialization Error.",{cause:c})}},stopScan:u,onFrame:(t=({timeElapsed:e=0,type:n="",percentage:r=0,isFingerInView:i=!1})=>{})=>{typeof t=="function"&&(I=t)},onScanFinish:(t=({raw_intensity:e=[],ppg_time:n=[],average_fps:r=0})=>{})=>{typeof t=="function"&&(M=t)},onError:(t=(e=new Error("Fingerscan Error."))=>{})=>{typeof t=="function"&&(w=t)},get isInitializing(){return()=>!g},get isScanning(){return()=>!!g}}})(),x=A;export{x as default};
