var A=(()=>{let f=1e4,m=6e4,c=!1,g=!1,y=0,b=0,p=0,E,o,h,l,v=[],F=[],I=({timeElapsed:t=0,type:e="",percentage:n=0,isFingerInView:r=!1})=>{},B=({raw_intensity:t=[],ppg_time:e=[],average_fps:n=0})=>{},w=(t=new Error("Fingerscan Error."))=>{},M=()=>new Promise(async(t,e)=>{var n,r,i;try{let a=await navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"environment",aspectRatio:1.7777777777777777}});(i=(r=(n=a.getVideoTracks())==null?void 0:n[0])==null?void 0:r.applyConstraints)==null||i.call(r,{advanced:[{torch:!0}]}).catch(s=>console.error(new Error("Flash could not be acquired.",{cause:s}))),o.srcObject=a,o.onloadedmetadata=()=>{t()}}catch(a){e(new Error("We are not able to access the Camera. Please try again.",{cause:a}))}}),d=(t=!1)=>{var e,n,r,i;cancelAnimationFrame(y),(i=(r=(n=(e=o==null?void 0:o.srcObject)==null?void 0:e.getTracks)==null?void 0:n.call(e))==null?void 0:r.forEach)==null||i.call(r,a=>{var s;(s=a==null?void 0:a.stop)==null||s.call(a)}),g=!1,window.onblur=void 0,E==null||E.release().then(()=>console.log("WakeLock Released.")).catch(a=>{console.log("WakeLock Error."),console.error(a)}),t||B({raw_intensity:v,ppg_time:F,average_fps:Math.round(v.length*1e3/m)})},W=(t={r:0,g:0,b:0})=>{let e;if(t.r<(c?25:5))e=0;else{let n=t.g+t.b,r=c?35:60,i=c?125:150;n<=r?e=1:n>=i?e=0:e=(i-n)/r}return e},R=t=>{let e=0,n={r:0,g:0,b:0};for(let r=0;r<t.data.length;r+=4)t.data[r+3]>0&&(e++,n.r+=t.data[r],n.g+=t.data[r+1],n.b+=t.data[r+2]);return{r:n.r/e,g:n.g/e,b:n.b/e}},q=()=>{let t=o.videoWidth,e=o.videoHeight;l.save(),l.clearRect(0,0,t,e),l.drawImage(o,0,0,t,e);let n=R(l.getImageData(t/5,e/5,t*.6,e*.6));return l.restore(),n},C=async t=>{let e=t-b;try{if(e<=f){let n=q(),r=W(n);I({timeElapsed:e,type:"calibration",percentage:Math.round(e/f*100),isFingerInView:r>.6}),y=requestAnimationFrame(C)}else if(e<=f+m){let n=q(),r=W(n);if(r>.6?p=0:c?p=101:p++,p>100){d(!0),w(new Error("Finger movement detected during the scan."));return}v.push(n),F.push(performance.now()-b),I({timeElapsed:e,type:"scan",percentage:Math.round((e-f)/m*100),isFingerInView:r>.6}),y=requestAnimationFrame(C)}else d()}catch(n){d(!0),w(new Error("Sorry we're unable to compute the signal. Please try again.",{cause:n}))}};return{startScan:async({calibrationTime_inSec:t=10,scanTime_inSec:e=60,strict_mode:n=!1,videoElement:r,canvasElement:i})=>{var a,s;v=[],F=[],g=!1,p=0;try{if(typeof t!="number"||t<3||t>20)throw new Error("Calibration duration can be between 3-20 seconds.");if(typeof e!="number"||e<10||e>120||e%5!==0)throw new Error("Scan duration can be between 10-120 seconds (multiple of 5).");if(t>e)throw new Error("Scan duration cannot be smaller than Calibration duration.");if(f=t*1e3,m=e*1e3,typeof n!="boolean"?(console.error("Provided Strict Mode value is Invalid!\nSwitching to default..."),c=!1):c=n,(a=navigator.wakeLock)==null||a.request("screen").then(u=>{E=u,console.log("WakeLock Active.")}).catch(u=>{console.log("WakeLock Error."),console.error(u)}),o=typeof r>"u"?document.getElementById("videoInput"):r,o)await M(),await((s=o.play)==null?void 0:s.call(o));else throw new Error("Cannot get the video element.");if(h=typeof i>"u"?document.getElementById("canvasOutput"):i,h)h.width=o.videoWidth,h.height=o.videoHeight,l=h.getContext("2d");else throw new Error("Cannot get the canvas element.");b=performance.now(),y=requestAnimationFrame(C),g=!0,window.onblur=()=>{d(!0),w(new Error("App functionality disabled in the Background. Keep it in the Foreground for proper operation."))}}catch(u){throw d(!0),w(u),new Error("Fingerscan Initialization Error.",{cause:u})}},stopScan:d,onFrame:(t=({timeElapsed:e=0,type:n="",percentage:r=0,isFingerInView:i=!1})=>{})=>{typeof t=="function"&&(I=t)},onScanFinish:(t=({raw_intensity:e=[],ppg_time:n=[],average_fps:r=0})=>{})=>{typeof t=="function"&&(B=t)},onError:(t=(e=new Error("Fingerscan Error."))=>{})=>{typeof t=="function"&&(w=t)},get isInitializing(){return()=>!g},get isScanning(){return()=>!!g}}})(),x=A;export{x as default};
